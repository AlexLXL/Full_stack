```
/**
* 从外部引入这些变量
* 但为了缩小体积, 上线使用CDN的方式引入, 并引入到项目中
* 配置output.libraryTarget: 'umd'使用
*/
externals: {
    'vue': 'Vue',
    'jquery': 'window.$'
},
```

img-loader - 对图片进行压缩


```
https://blog.csdn.net/mmiaoChong/article/details/119769030
core-js@3升级之后弃用了@babel/polyfill
babel7.4版本不支持babel-polyfill
@babel/polyfill = core-js + regenerator-runtime
```

---


### 一、webpack优化

#### 1.不需要laoder的文件不执行loader(jquery、lodash)

```
module: {
    // 优化: 内部没有require和import的模块可以不解析, 加快构构建
+    noParse: /jquery|lodash/,
    rules: []
}
```

#### 2.替换第三方库 或者 减少第三方库的打包内容 (moment) (组件库的按需打包)

1) day.js替代moment
2) 排查moment文件为什么这么大(700k), 发现是local国际化的文件很多, 
   因此可以忽略这个local文件(可以减少500k)

```
// webpack配置plugin
+ new webpack.IgnorePlugin({
+   contextRegExp: /moment$/,
+   resourceRegExp: /^\.\/locale/
+ })

// 项目里手动引入中文
require('moment/local/zh-cn')
```

3) 组件库的按需加载 [babel-loader + babel-plugin-import 来按需打包]

```
{
    test: /\.js$/,
    exclude: /node_modules/,
    use: {
        loader: 'babel-loader',
        options: {
            presets: ["@babel/preset-env", '@babel/preset-react'],
            plugins: [
                ["@babel/plugin-proposal-decorators", {legacy: true}],
                ["@babel/plugin-proposal-private-property-in-object", {"loose": true}],
+                ["import", {libraryName: 'lodash', libraryDirectory: ''}]
            ],
        },
    },
},
```

#### 3.费时分析(loader用了多久, plugin用了多久) + 日志输出 

webpack.config.js

```
+ const SpeedMeasureWebpackPlugin = require('speed-measure-webpack-plugin');
+ const smw = new SpeedMeasureWebpackPlugin();
+ module.exports =smw.wrap({
    // ...配置...
    entry: "./src/index.html",
    output: {
        path: ""
        filename: ""
    },
    module: {
        rules: []
    },
    plugins: []
+ });
```

package.json

```
"scripts": {
    "build": "webpack",
+    "build:state": "webpack --json > states.json"
}
```

运行 `npm run build:state` 输出文件 `states.json`

#### 4.生成打包后的文件报告(各个模块大小)

```
+ const {BundleAnalyzerPlugin} = require('webpack-bundle-analyzer');
+ module.exports={
+   plugins: [
+     new BundleAnalyzerPlugin()
+   ]
+ }
```

#### 5.1.优化压缩js
```
+const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
    +  mode: 'none',
      devtool: false,
      entry: './src/index.js',
    +  optimization: {
    +    minimize: true,
    +    minimizer: [
    +      new TerserPlugin(),
    +    ],
    +  },
}
```

#### 5.2.优化压缩html
```
plugins: [
    new HtmlWebpackPlugin({
        template: './src/index.html',
    +     minify: {  
    +        collapseWhitespace: true,
    +        removeComments: true
    +     }
     }),
]
```

#### 5.3.优化压缩css
```
const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin');

plugins: [
+   new OptimizeCssAssetsWebpackPlugin(),
]
```

#### 5.4.去除未使用的css
```
// 在配此之前要配好mini-css-extract-plugin和css-loader
npm i  purgecss-webpack-plugin glob -D

plugins: [
+    new PurgecssPlugin({
+      paths: glob.sync(`${PATHS.src}/**/*`,  { nodir: true }),
+    })
]
```