```
教程: https://www.bilibili.com/video/BV12K411A7A2?p=7
开发者文档: https://developers.weixin.qq.com/miniprogram/dev/framework/
官网登录: https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=186565225&lang=zh_CN
```

## 一、知识点

### 1.像素

![](http://120.79.201.10:9000/wechat/001.jpg)

### 2.IDE开发小程序

![](http://120.79.201.10:9000/wechat/017.IDE配置开发小程序.jpg)

![](http://120.79.201.10:9000/wechat/018.IDE配置开发小程序2.jpg)

用webStorm打开项目就好, 和开发者工具公用一个目录, 所以就可以开发啦

### 3.使用iconfont:
- 不能使用url的方式, 把整个.css下载下来, 然后改名.wxss
- 全局引入`@imprt "/static/iconfont/iconfont.wxss""`

## 二、html和js

### 1.各种标签
```
<view> = <div>
<text> = <span>
<image src="">
```

### 2.条件语句

```
<text wx:if="{{userInfo.name}}">123</text>
<text wx:elif="{{!userInfo.name}}">456</text>
<text wx:else>456</text>
```

```
// 循环
<view wx:for="{{bannerList}}" wx:key="bannerId">
    {{item.name}}
</view>

// <view wx:for="{{bannerList}}" wx:for-item="bannerItem" wx:key="bannerId">
//     {{bannerItem.name}}
// </view>
```

### 3.组件
- button: [按钮(可用于获取用户信息)](https://developers.weixin.qq.com/miniprogram/dev/component/button.html)  
- swiper: [轮播图](https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html)  
- scroll-view: [区域滚动(横向纵向)](https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html)
- wx.showToast: [中间提示信息](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showToast.html)
- wx.showLoading: [中间提示加载](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showLoading.html)
- wx.hideLoading(): [中间提示加载关闭]

### 4.绑定数据(vue)/修改数据(react)
index.html
```
<view>
    <text>{{name}}</text>
</view>
```

index.js
```
Page({
  data: {
    name: 'alex'
  },
  onLoad: function (options) {
    this.setData({
      name: 'alex1'
    })
    this.data.name // OUTPUT:'alex1'; 同步修改,这和react不同
  },
})
```

### 5.绑定事件

```
// 不冒泡
<view catchtap="handleTap"></view>
// 冒泡
<view bindtap="handleTap"></view>

Page({
  data: {
    ...
  },

  handletap() {
    console.log(1111)
  },
})
```

- bindtouchstart="handleTouchStart"
- bindtouchmove="handleTouchMove"
- bindtouchend="handleTouchEnd"
- bindinput="handleInput"

![](http://120.79.201.10:9000/wechat/012.jpg)

### [请求接口](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html)

-本地开发用的url, 要在官网开发里面配置`开发->开发设置->服务器域名`  
-最多配置20个域名  
-只能使用https

![](http://120.79.201.10:9000/wechat/019.开发过程使用http.jpg)

util.config
```
//配置服务器相关信息
export default{
  host:'http://localhost:3000',
  mobileHost:'https://manster1231.cn1.utools.club'
}
```

util.request.js
```
import config from '../utils/config'
export default (url,data={},method='GET')=>{
  return new Promise((resolve,reject)=>{
    //初始化promise实例的状态为pending
    wx.request({
        url:config.host + url,//请求地址
        data:data,//请求参数对象
        method:method,//请求方法
        header: {
          cookie: wx.getStorageSync('cookies') ? wx.getStorageSync('cookies').find(item => item.indexOf('MUSIC_U') !== -1):''
        },
        
        success:(res)=>{
        if(data.isLogin){//登录请求,将用户cookie存入
          wx.setStorage({
            key: 'cookies',
            data: res.cookies,
          })
        }

          resolve(res.data);
        },
        fail:(err)=>{
          reject(err);
        }
    })
  })
}
```

使用
```
let result = await request('/user/record',{uid: userId,type: 0});
```


### 6.保存数据到本地
[链接](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorageSync.html)
```
wx.setStorageSync('userInfo', JSON.stringify(result.profile))
let userInfo = wx.getStorageSync('userInfo');
```

### 7.路由跳转

index.html
```
<view class="container">
  <text catchtap="toLog">toLog</text>
</view>
```

index.js
```
Page({
  data: {
    name: 'alex',
    age: 1
  },

  toLog() {
    wx.navigateTo({
      url: '/pages/log/index',
      success: function(res) {
        console.log('跳转成功')
      }
    })
  },
```

![](http://120.79.201.10:9000/wechat/013.jpg)

### 8.生命周期

总共五个声明周期: onLoad/onShow/onReady/onHide/onUnLoad

- onLoad: 加载页面,还没this.data(官网的图是没有的, 但实际是有的)
    - 判断token看是否需要重新授权
- onShow: 显示页面,还没this.data(官网的图是没有的, 但实际是有的)
- onReady: 初次渲染完成
- onHide: 隐藏页面
- onUnLoad: 卸载页面

![](http://120.79.201.10:9000/wechat/014.生命周期.png)

具体路由对应的生命周期

![](http://120.79.201.10:9000/wechat/015.路由触发生命周期.jpg)

### 9.获取用户基本信息

> 不推荐使用getUserInfo获取用户信息，预计自2021年4月13日起，getUserInfo将不再弹出弹窗，并直接返回匿名的用户个人信息

2021.4之后改成
```
<button catchtap="getUserProfile">获取头像和昵称</button>

getUserProfile(){
    wx.getUserProfile({
      desc: '获取用户信息',
      success: (res) => {
        console.log(res)
        this.setData({
          userInfo: res.userInfo,
          hasUserInfo: true
        })
      }
    })
}
```

之前的
```
<view>
  <button open-type="getUserInfo"
  bindgetuserinfo="getUserInfo">获取头像和昵称</button>
</view>

// js
getUserInfo(e) {
    console.log(e)
}
```

### 10.钩子
```
// 下拉
onPullDownRefresh: function () {

},

// 上拉
onReachBottom: function () {

},

// 分享
onShareAppMessage: function ({from}) {

}
```

### 支付流程

1.静默登录

![](http://120.79.201.10:9000/wechat/020.静默登录.jpg)

2.[支付](https://juejin.cn/post/6844903895970349064)


### token问题(授权后不再授权)
### 常见问题




## 问题
### 1.跳转的时候改变头部标签
配置组件的index.json
```
{
  "usingComponents": {},
  "navigationBarTitleText": "log"
}
```
查看常用API


## 二、开始

#### 1.创建

![](http://120.79.201.10:9000/wechat/002.jpg)

#### 2.开发界面

![](http://120.79.201.10:9000/wechat/003.jpg)

// 预览的功能, 需要在官网配置允许扫码预览的账号

#### 3.文件说明

sitemap.json

![](http://120.79.201.10:9000/wechat/004.jpg)

![](http://120.79.201.10:9000/wechat/005.jpg)

app.js

![](http://120.79.201.10:9000/wechat/006.jpg)

![](http://120.79.201.10:9000/wechat/007.jpg)

app.json  
[配置底部导航-tabBar](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)
> 跳转tabBar方式: wx.reLaunch({url: '/aa'})/wx.switchTab({url: '/aa'})

![](http://120.79.201.10:9000/wechat/008.jpg)

![](http://120.79.201.10:9000/wechat/009.jpg)

app.wxss

![](http://120.79.201.10:9000/wechat/010.jpg)

组件

![](http://120.79.201.10:9000/wechat/011.jpg)







