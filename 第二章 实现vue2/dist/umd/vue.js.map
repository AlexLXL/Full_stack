{"version":3,"file":"vue.js","sources":["../../src/utils/utils.js","../../src/observe/array.js","../../src/observe/dep.js","../../src/observe/index.js","../../src/state.js","../../src/compiler/parserHTML.js","../../src/compiler/astGenerateCode.js","../../src/compiler/index.js","../../src/vdom/index.js","../../src/vdom/patch.js","../../src/async/nextTick.js","../../src/observe/schedule.js","../../src/observe/watcher.js","../../src/globalAPI/index.js","../../src/lifeCycle.js","../../src/init.js","../../src/render.js","../../src/index.js"],"sourcesContent":["export function isFunction(val) {\r\n    return typeof val === \"function\";\r\n}\r\n\r\nexport function isObject(val) {\r\n    return typeof val === \"object\" && val !== null;\r\n}\r\n\r\nexport function isArray(val) {\r\n    return Array.isArray(val);\r\n}\r\n","let oldArrayPrototype = Array.prototype\r\nexport let arrayMethods = Object.create(oldArrayPrototype)\r\nlet methods = [\"push\", \"pop\", \"unshift\", \"shift\", \"reverse\", \"sort\", \"splice\",]\r\nmethods.forEach((method) => {\r\n    arrayMethods[method] = function (...args) {\r\n        oldArrayPrototype[method].apply(this, args)\r\n        // 对增加的元素进行监听\r\n        let addElement = null\r\n        switch (method) {\r\n            case \"splice\":\r\n                addElement = args.slice(2)\r\n                break;\r\n            case \"push\":\r\n            case \"unshift\":\r\n                addElement = args\r\n                break;\r\n        }\r\n        addElement && this.__ob__.observeArray(addElement)\r\n        this.__ob__.dep.notify()\r\n    }\r\n})","let id = 0\r\nexport class Dep {\r\n    constructor() {\r\n        this.id = id++\r\n        this.watchers = []\r\n    }\r\n    depend() {\r\n        Dep.target.addDep(this)\r\n    }\r\n    // addSub方法,改一下名好辨识\r\n    addWatcher(watcher) {\r\n        this.watchers.push(watcher)\r\n    }\r\n    notify() {\r\n        this.watchers.forEach(watcher => watcher.update())\r\n    }\r\n}\r\nDep.target = null","import {isArray, isObject} from \"../utils/utils\";\r\nimport {arrayMethods} from \"./array\";\r\nimport {Dep} from \"./dep\";\r\n\r\nexport function observe(data) {\r\n    if (!isObject(data)) return\r\n    if (data.__ob__) return\r\n    return new Observer(data)\r\n}\r\n\r\nclass Observer {\r\n    constructor(data) {\r\n        // 添加dep保存在__ob__下,方便对象和数组调用而已。\r\n        // 数组原本没存dep(对比上一条git),而对象是原本就有(现在加多一个__ob__.dep能添加属性的时候用)\r\n        this.dep = new Dep()\r\n        Object.defineProperty(data, \"__ob__\", {\r\n            value: this,\r\n            enumerable: false\r\n        })\r\n        if (isArray(data)) {\r\n            data.__proto__ = arrayMethods\r\n            this.observeArray(data)\r\n        }else {\r\n            this.walk(data)\r\n        }\r\n    }\r\n    walk(data) {\r\n        Object.keys(data).forEach((key) => {\r\n            definedReactive(data, key, data[key])\r\n        })\r\n    }\r\n    observeArray(arr) {\r\n        arr.forEach(observe)\r\n    }\r\n}\r\n\r\n/**\r\n * 性能问题1: 对象嵌套太多会影响性能\r\n * @param data\r\n * @param key\r\n * @param value\r\n * @returns {*}\r\n */\r\nfunction definedReactive(data, key, value) {\r\n    let dep = new Dep()\r\n    let innerOb = observe(value)\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            if (Dep.target) {\r\n                dep.depend()\r\n                if (innerOb) {\r\n                    innerOb.dep.depend()\r\n                    if (isArray(value)) {\r\n                        dependArray(value);\r\n                    }\r\n                }\r\n            }\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return;\r\n            if (isObject(newValue)) { observe(newValue) }\r\n            value = newValue\r\n            dep.notify()\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * 边界问题处理:\r\n * 问题: 页面使用{{arr}};  data:{ arr = [[]] }; 进行修改arr[0].push(100)发现没触发更新\r\n * 解答: 这时只对arr最外层数组的__ob__.dep搜集了watcher, arr[0]没有搜集watcher,\r\n *       所以要递归给内部的也加上外部的watcher\r\n */\r\nfunction dependArray(arr) {\r\n    for(let i = 0; i < arr.length;i++){\r\n        let current = arr[i];\r\n        current.__ob__ && current.__ob__.dep.depend(); // 依赖收集\r\n        if(isArray(current)) {\r\n            dependArray(current);\r\n        }\r\n    }\r\n}","import {isFunction} from \"./utils/utils\";\r\nimport {observe} from \"./observe\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options\r\n\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data\r\n    data = vm._data = isFunction(data) ? data() : data\r\n    observe(data)\r\n\r\n    for (let key in data) {\r\n        proxy(vm, key, \"_data\")\r\n    }\r\n}\r\n\r\n/**\r\n * 易混淆: 这里是将“options的data”代理到实例 和 new Vue(options)的options没任何关联, options的任何属性都不会挂载到实例\r\n * @param vm\r\n * @param key\r\n * @param source\r\n * @returns {*}\r\n */\r\nfunction proxy(vm, key, source) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[source][key]\r\n        },\r\n        set(v) {\r\n            vm[source][key] = v\r\n        }\r\n    })\r\n}","// 用\"html\".match(new RegExp(ncname))匹配\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名，子模块aaa-bbb\r\n/*[\r\n    0: \"aa-bb\"\r\n    groups: undefined\r\n    index: 1\r\n    input: \"<aa-bb>2131</aa-bb>\"\r\n    length: 1\r\n]*/\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // 命名空间标签，aa:aa-xxx。很少用\r\n/*[\r\n    0: \"aa-bb\"\r\n    1: \"aa-bb\"\r\n    groups: undefined\r\n    index: 1\r\n    input: \"<aa-bb>2131</aa-bb>>\"\r\n    length: 2\r\n]*/\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // <标签名和标签名，0: <aa:aa-xxx或<aa-aa, 1: aa:aa-xxx或aa-aa\r\n/*[\r\n    0: \"<aa-bb\"\r\n    1: \"aa-bb\"\r\n    groups: undefined\r\n    index: 0\r\n    input: \"<aa-bb>2131</aa-bb>\"\r\n    length: 2\r\n]*/\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 属性\r\n/*{\r\n    0: \"title = 123\"    // 完整字符串\r\n    1: \"title\"      // key\r\n    2: \"=\"          // 等号\r\n    3: undefined    // 双引号\r\n    4: undefined    // 单引号\r\n    5: \"123\"        // 无引号\r\n    groups: undefined\r\n    index: 0\r\n    input: \"title = 123></aa-bb>\"\r\n    length: 6\r\n}*/\r\nconst startTagClose = /^\\s*(\\/?)>/; // 标签结束, >或/>\r\n/*{\r\n    0: \"/>\"\r\n    1: \"/\"\r\n    groups: undefined\r\n    index: 0\r\n    input: \"/>32323\"\r\n    length: 2\r\n}*/\r\n// const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // // 文本, {{message}}\r\n/*{\r\n    0: \"{{message}}\"\r\n    length: 1\r\n}*/\r\nconst endTagReg = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 标签结束 0: </aa-bb>, 1: aa-bb\r\n/*{\r\n    0: \"</aa-bb>\"\r\n    1: \"aa-bb\"\r\n    groups: undefined\r\n    index: 0\r\n    input: \"</aa-bb>\"\r\n    length: 2\r\n}*/\r\n\r\nexport function parserHTML(html) {\r\n    let root = null\r\n    let stack = [] // 利用入栈/出栈来 对应 开始标签/结束标签, 来完善root\r\n    while(html) {\r\n        let idx = html.indexOf(\"<\")\r\n        // 开始标签/结束标签\r\n        if (idx === 0) {\r\n            let startTag = parseStartTag()\r\n            if (startTag) {\r\n                start(startTag)\r\n                continue;\r\n            }\r\n            let endTag\r\n            if (endTag = html.match(endTagReg)) {\r\n                end(endTag[1])\r\n                advance(endTag[0].length)\r\n            }\r\n        }\r\n        // 内容\r\n        if (idx > 0) {\r\n            let content = html.substring(0, idx);\r\n            text(content);\r\n            advance(content.length);\r\n        }\r\n    }\r\n    function advance(len) {\r\n        html = html.substring(len)\r\n    }\r\n    function parseStartTag() {\r\n        let match = html.match(startTagOpen)\r\n        if (!match) { return false }\r\n        advance(match[0].length)\r\n\r\n\r\n        let result = {\r\n            tagName: match[1],\r\n            attrs: []\r\n        }\r\n        let end,\r\n            attr;\r\n        while(!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n            result.attrs.push({\r\n                name: attr[1],\r\n                value: attr[3] || attr[4] || attr[5]\r\n            })\r\n            advance(attr[0].length)\r\n        }\r\n        if (end) {\r\n            advance(end[0].length)\r\n        }\r\n        return result\r\n    }\r\n    function start({tagName, attrs}) {\r\n        let parent = stack[stack.length - 1]\r\n        let element = createASTElement(tagName, attrs, parent)\r\n        if (parent) {\r\n            parent.children.push(element)\r\n        }\r\n        if (root === null) {\r\n            root = element\r\n        }\r\n        stack.push(element)\r\n    }\r\n    function end(tagName) {\r\n        if (stack.pop().tag !== tagName) {\r\n            console.log(`闭合标签和开始标签不匹配`)\r\n        }\r\n    }\r\n    function text(content) {\r\n        let parent = stack[stack.length - 1]\r\n        content = content.replace(/\\s/g, '')\r\n        if (content) {\r\n            parent.children.push({\r\n                text: content,\r\n                type: 2\r\n            })\r\n        }\r\n    }\r\n    function createASTElement(tag, attrs, parent) {\r\n        return {\r\n            tag,\r\n            attrs,\r\n            parent,\r\n            type: 1,\r\n            children: []\r\n        }\r\n    }\r\n\r\n    return root\r\n}\r\n\r\n","let defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配文本, {{message}}\r\n/*{\r\n    0: \"{{message}}\"\r\n    length: 1\r\n}*/\r\n\r\nexport function astGenerateCode(ast) {\r\n    let children = genChildren(ast)\r\n    let code = \r\n        `_c(\"${ast.tag}\",\r\n            ${\r\n                ast.attrs.length ? genProps(ast.attrs) : undefined\r\n            },\r\n            ${\r\n                children ? `${children}` : \"\"\r\n            }\r\n        )`\r\n    return code\r\n}\r\nfunction genProps(attr) {\r\n    let result = \"\"\r\n    attr.forEach(item => {\r\n        if (item.name === 'style') {\r\n            let styles = {}\r\n            item.value.replace(/([^;:]+):([^;:]+)/g, (...args) => {\r\n                styles[args[1]] = args[2].trim()\r\n            })\r\n            item.value = styles\r\n        }\r\n        result += `${item.name}:${JSON.stringify(item.value)},`\r\n    })\r\n    return `{${result.slice(0,-1)}}`\r\n}\r\nfunction genChildren(ast) {\r\n    let children = ast.children\r\n    if (children) {\r\n        return children.map(gen).join(\",\")\r\n    }\r\n    return false\r\n}\r\nfunction gen(subAst) {\r\n    if (subAst.type === 1) {\r\n        return astGenerateCode(subAst)\r\n    }else {\r\n        let text = subAst.text\r\n        if (!defaultTagRE.test(text)) return `_v(\"${text}\")`\r\n        defaultTagRE.lastIndex = 0\r\n\r\n        let result = []\r\n        let low = 0\r\n        let match;\r\n        while(match = defaultTagRE.exec(text)) {\r\n            let fast = match.index\r\n            if (fast > low) {\r\n                result.push(JSON.stringify(text.slice(low, fast)))\r\n            }\r\n            result.push(`_s(${match[1].trim()})`)\r\n            low = fast + match[0].length\r\n        }\r\n        if (low < text.length) {\r\n            result.push(JSON.stringify(text.slice(low)))\r\n        }\r\n        return `_v(${result.join('+')})`\r\n    }\r\n}","import {parserHTML} from \"./parserHTML\";\r\nimport {astGenerateCode} from \"./astGenerateCode\";\r\n\r\nexport function compilerToFunction(html) {\r\n    let ast = parserHTML(html)\r\n\r\n    let code = astGenerateCode(ast)\r\n\r\n    let render = new Function(`with(this) { return ${code} }`)\r\n\r\n    return render\r\n}","import {isObject} from \"../utils/utils\";\r\n\r\nexport function createVnodeEle(vm, tag, data = {}, ...children) {\r\n    if (!isReservedTag(tag)) {\r\n        let Ctor = vm.$options.components[tag]\r\n        return createComponent(vm, tag, data = {}, children, data.key, Ctor)\r\n    }\r\n    return vnode(vm, tag, data, children, data.key, undefined)\r\n}\r\nexport function createVnodeText(vm, text) {\r\n    return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\nfunction vnode(vm, tag, data = {}, children, key, text, componentOptions) {\r\n    return {\r\n        vm,\r\n        tag,\r\n        data,\r\n        children,\r\n        key,\r\n        text,\r\n        componentOptions\r\n    }\r\n}\r\n\r\nexport function isSameNode(oldVnode, newVnode) {\r\n    return (oldVnode.tag === newVnode.tag) && (oldVnode.key == newVnode.key)\r\n}\r\n\r\nexport const isReservedTag = makeMap(\r\n    'template,script,style,element,content,slot,link,meta,svg,view,' +\r\n    'button,a,div,img,image,text,span,input,switch,textarea,spinner,select,' +\r\n    'slider,slider-neighbor,indicator,canvas,' +\r\n    'list,cell,header,loading,loading-indicator,refresh,scrollable,scroller,' +\r\n    'video,web,embed,tabbar,tabheader,datepicker,timepicker,marquee,countdown'\r\n)\r\n\r\nfunction makeMap(str) {\r\n    let tagList = str.split(',')\r\n    return function (tagName) {\r\n        return tagList.includes(tagName)\r\n    }\r\n}\r\n\r\n/**\r\n * @param vm\r\n * @param tag\r\n * @param data\r\n * @param children\r\n * @param Ctor 构造函数\r\n */\r\nfunction createComponent(vm, tag, data = {}, children, key, Ctor) {\r\n    if (isObject(Ctor)) {\r\n        Ctor = vm.$options._base.extend(Ctor)\r\n    }\r\n    // 组件的初始化、更新、插入、销毁\r\n    data.hook = {\r\n        init(vnode) {\r\n            let component = vnode.componentInstance = new Ctor({})    // 返回Vue子类实例,会触发组件的_init(),进行数据劫持\r\n            component.$mount()  // 由于没有el,手动挂载一下,进行render和update\r\n        },\r\n        prepatch() {},\r\n        insert() {},\r\n        destroy() {},\r\n    }\r\n    let vNode = vnode(vm, tag, data, undefined, key, undefined, {Ctor, children, tag})\r\n    return vNode\r\n}","/**\r\n * vnode => real dom\r\n */\r\nimport {isObject} from \"../utils/utils\";\r\nimport {isSameNode} from \"./index\";\r\n\r\n/**\r\n * 节点比对, 递归的方式, 有差异就替换\r\n * 属性比对\r\n * @param oldVnode\r\n * @param newVnode\r\n * @returns {*}\r\n */\r\nexport function patch(oldVnode, newVnode) {\r\n    if (!oldVnode) {\r\n        return createElm(newVnode)\r\n    }\r\n    if (oldVnode.nodeType) {\r\n        let parentNode = oldVnode.parentNode\r\n        let realDom = createElm(newVnode)\r\n        parentNode.insertBefore(realDom, oldVnode.nextSibing);\r\n        parentNode.removeChild(oldVnode);\r\n        return realDom\r\n    }else {\r\n        // 节点不同\r\n        if (!isSameNode(oldVnode, newVnode)) {\r\n            return oldVnode.el.parentNode.replaceChild(createElm(newVnode), oldVnode.el)\r\n        }\r\n\r\n        // 节点相同\r\n        let el = newVnode.el = oldVnode.el\r\n        if (!oldVnode.tag) {\r\n            if (oldVnode.text !== newVnode.text) {\r\n                return el.textContent = newVnode.text\r\n            }\r\n        }\r\n        createElmProp(newVnode, oldVnode.data)\r\n        let oldChildren = oldVnode.children || []   // 比较儿子\r\n        let newChildren = newVnode.children || []\r\n        if (oldChildren.length && !newChildren.length) {\r\n            el.innerHTML = ''\r\n        }else if (!oldChildren.length && newChildren.length) {\r\n            newChildren.forEach(child => el.appendChild(createElm(child)))\r\n        }else {\r\n            updateChildren(el, oldChildren, newChildren)\r\n        }\r\n        return el\r\n    }\r\n}\r\nexport function createElm(vnode) {\r\n    let {vm, tag, data, children, text} = vnode\r\n    if (tag) {\r\n        if (createComponentElm(vnode)) {\r\n            return vnode.componentInstance.$el\r\n        }\r\n        // 在vnode.el都存了真实dom\r\n        vnode.el = document.createElement(tag)\r\n        createElmProp(vnode, data)\r\n        children.forEach(child => {\r\n            vnode.el.appendChild(createElm(child))\r\n        })\r\n    }else {\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n    return vnode.el\r\n}\r\n// 是否组件Vnode\r\nfunction createComponentElm(vnode) {\r\n    let i = vnode.data\r\n    if ((i = i.hook) && (i = i.init)) {\r\n        i(vnode)\r\n    }\r\n    if (vnode.componentInstance) {\r\n        return true\r\n    }\r\n}\r\nfunction createElmProp(newVnode, oldProps={}) {\r\n    let el = newVnode.el\r\n    let newProps = newVnode.data || {}\r\n\r\n    let newStyle = newProps.style || {}\r\n    let oldStyle = oldProps.style || {}\r\n    for (let key in oldStyle) {\r\n        if (!newStyle[key]) {\r\n            el.style[key] = \"\"\r\n        }\r\n    }\r\n\r\n    for (let key in newProps) {\r\n        if (key === 'style') {\r\n            for (let s in newStyle) {\r\n                el.style[s] = newStyle[s]\r\n            }\r\n        }else {\r\n            el.setAttribute(key, newProps[key])\r\n        }\r\n    }\r\n    for (let key in oldProps) {\r\n        if (!newProps[key]) {\r\n            el.removeAttribute(key)\r\n        }\r\n    }\r\n}\r\nfunction updateChildren(el, oldChildren, newChildren) {\r\n    let oldStartIndex = 0\r\n    let oldStartVnode = oldChildren[0]\r\n    let oldEndIndex = oldChildren.length - 1\r\n    let oldEndVnode = oldChildren[oldEndIndex]\r\n    let newStartIndex = 0\r\n    let newStartVnode = newChildren[0]\r\n    let newEndIndex = newChildren.length - 1\r\n    let newEndVnode = newChildren[newEndIndex]\r\n    let mapping = makeKeyByIndex(oldChildren)\r\n    // 头头、尾尾、头尾、尾头、乱序\r\n    while((oldStartIndex <= oldEndIndex) && (newStartIndex <= newEndIndex)) {\r\n        if (!oldStartVnode) {\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n        }else if (!oldEndVnode) {\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n        }else if (isSameNode(oldStartVnode,newStartVnode)) {\r\n            patch(oldStartVnode, newStartVnode)\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }else if (isSameNode(oldEndVnode, newEndVnode)) {\r\n            patch(oldEndVnode, newEndVnode)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newEndVnode = newChildren[--newEndIndex]\r\n        }else if (isSameNode(oldStartVnode, newEndVnode)) {\r\n            patch(oldStartVnode, newEndVnode)\r\n            el.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling)\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newEndVnode = oldChildren[--newEndIndex]\r\n        }else if (isSameNode(oldEndVnode, newStartVnode)) {\r\n            patch(oldEndVnode, newStartVnode)\r\n            el.insertBefore(oldEndVnode.el, newStartVnode.el)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }else {\r\n            let moveIndex = mapping[newStartVnode.key]\r\n            if (moveIndex === undefined) {\r\n                el.insertBefore(createElm(newStartVnode), oldStartVnode.el)\r\n            }else {\r\n                let moveVnode = oldChildren[moveIndex]\r\n                patch(moveVnode, newStartVnode)\r\n                el.insertBefore(moveVnode.el, oldStartVnode.el)\r\n                oldChildren[moveIndex] = undefined\r\n            }\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }\r\n    }\r\n    if (newStartIndex <= newEndIndex) {\r\n        for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n            let anchor = newChildren[newEndIndex + 1] ? newChildren[newEndIndex + 1].el : null\r\n            el.insertBefore(createElm(newChildren[i]), anchor)\r\n        }\r\n    }\r\n    if (oldStartIndex <= oldEndIndex) {\r\n        for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n            let child = oldChildren[i]\r\n            child && el.removeChild(child.el)\r\n        }\r\n    }\r\n}\r\nfunction makeKeyByIndex(children) {\r\n    let map = {}\r\n    children.forEach((item, index) => {\r\n        map[item.key] = index\r\n    })\r\n    return map\r\n}\r\n","let queue = []\r\nlet free = true\r\n\r\nexport function nextTick(fn) {\r\n    queue.push(fn)\r\n    if (free) {\r\n        Promise.resolve().then(flushSchedulerQueue)\r\n        free = false\r\n    }\r\n}\r\nfunction flushSchedulerQueue() {\r\n    queue.forEach(fn => fn())\r\n    queue = []\r\n    free = true\r\n}","import {nextTick} from \"../async/nextTick\";\r\n\r\nlet ids = new Set()\r\nlet queue = []\r\nlet free = true\r\n\r\n/**\r\n * 和防抖有些不同,\r\n * 这里是把render放到微任务,等同步代码执行完, 然后就会执行render\r\n */\r\nexport function queueWatcher(watcher) {\r\n    let id = watcher.id\r\n    if (!ids.has(id)) {\r\n        ids.add(id)\r\n        queue.push(watcher)\r\n    }\r\n    if (free) {\r\n        nextTick(flushSchedulerQueue)\r\n        free = false\r\n    }\r\n}\r\nfunction flushSchedulerQueue() {\r\n    queue.forEach(watcher => watcher.run())\r\n    ids.clear()\r\n    queue = []\r\n    free = true\r\n}","import {Dep} from \"./dep\";\r\nimport {queueWatcher} from \"./schedule\";\r\n\r\nlet id = 0\r\nexport class Watcher {\r\n    constructor(vm, updateCpmponent, cb) {\r\n        this.id = id++;\r\n        this.vm = vm;\r\n        this.getter = updateCpmponent;\r\n        this.cb = cb;\r\n        this.depIds = new Set();\r\n        this.deps = [];\r\n\r\n        this.get();\r\n    }\r\n    get() {\r\n        Dep.target = this\r\n        this.getter()\r\n        Dep.target = null\r\n    }\r\n    addDep(dep) {\r\n        let depId = dep.id\r\n        if (!this.depIds.has(depId)) {\r\n            this.depIds.add(depId)\r\n            this.deps.push(dep)\r\n            dep.addWatcher(this)\r\n        }\r\n    }\r\n    update() {\r\n        // 快速修改多次值会导致render多次\r\n        // this.get()\r\n        queueWatcher(this)\r\n    }\r\n    run() {\r\n        this.get()\r\n        // FIXME: 会再出发一次依赖收集, 有优化空间?\r\n    }\r\n}","import {isArray, isObject} from \"../utils/utils\";\r\n\r\n/**\r\n * 全局属性都存到Vue.options\r\n * 1.全局生命周期-保存到队列中，然后放到Vue.options.mounted = [fn, fn]\r\n * 2.全局组件-保存到队列中，然后放到Vue.options.components = {Sub, Sub}\r\n * @param Vue\r\n */\r\nexport function initGlobalAPI(Vue) {\r\n    Vue.options = {}\r\n    Vue.mixin = function (options) {\r\n        this.options = mergeOptions(this.options, options)\r\n    }\r\n\r\n    Vue.options.components = {}\r\n    Vue.component = function (id, definition) { // FIXME: definition为函数情况未处理\r\n        let name = definition.name || id\r\n        definition.name = name\r\n        if (isObject(definition)) {\r\n            definition = Vue.extend(definition)\r\n            // 内部自动调用Vue.extent(返回Vue的子类)\r\n        }\r\n        Vue.options.components[name] = definition\r\n    }\r\n    /**\r\n     * 创建一个函数作为Vue的子类(通过修改原型链)\r\n     * 内部存储了options和mixin属性\r\n     * @param opt\r\n     * @returns {Sub} 其实就是一个构造函数\r\n     */\r\n    Vue.extend = function(opt) {\r\n        const Super = this\r\n        const Sub = function (options) {\r\n            this._init(options)\r\n        }\r\n        Sub.prototype = Object.create(Super.prototype)  // 继承\r\n        Sub.prototype.constructor = Sub\r\n        Sub.options = mergeOptions(Super.options, opt)\r\n        Sub.mixin = Vue.mixin\r\n        return Sub\r\n    }\r\n\r\n    Vue.filter = function () {}\r\n    Vue.directive = function () {}\r\n    Vue.options._base = Vue\r\n}\r\n/*\r\nObject.create原理\r\nObject.create = function (parentPrototype) {\r\n    const Fn = function () {}\r\n    Fn.prototype = parentPrototype\r\n    return Fn\r\n}\r\n*/\r\n\r\n/**\r\n * 将全局属性组合起来(类似Object.assign)\r\n * ● 生命周期、Component\r\n * @param parentVal\r\n * @param childVal\r\n * @returns {{}}\r\n */\r\nexport function mergeOptions(parentVal, childVal) {\r\n    const options = {};\r\n    for(let key in parentVal) {\r\n        mergeFiled(key);\r\n    }\r\n    for(let key in childVal) {\r\n        if(!parentVal.hasOwnProperty(key)) {\r\n            mergeFiled(key);\r\n        }\r\n    }\r\n    function mergeFiled(key) {\r\n        let strategy = strategys[key];\r\n        if(strategy) {\r\n            options[key] = strategy(parentVal[key], childVal[key]);\r\n        }else {\r\n            options[key] = childVal[key] || parentVal[key];\r\n        }\r\n    }\r\n\r\n    return options;\r\n}\r\n\r\n/**\r\n * 生命周期合并策略\r\n * @type {{}}\r\n */\r\nlet strategys = {};\r\nlet lifeCycle = [\r\n    \"beforeCreate\",\r\n    \"created\",\r\n    \"beforeMount\",\r\n    \"mounted\"\r\n];\r\nlifeCycle.forEach(hook => {\r\n    strategys[hook] = function(parentVal, childVal) {\r\n        if(childVal) {\r\n            if(parentVal) {\r\n                return parentVal.concat(childVal);\r\n            }else {\r\n                if(isArray(childVal)) {\r\n                    return childVal\r\n                }\r\n                return isArray(childVal) ? childVal : [childVal];\r\n            }\r\n        }else {\r\n            return parentVal;\r\n        }\r\n    }\r\n})\r\n\r\n/**\r\n * 暴露声明周期函数\r\n * @param vm\r\n * @param hook\r\n */\r\nexport function callHook(vm, hook) {\r\n    let handlers = vm.$options[hook];\r\n    handlers && handlers.forEach(item => {\r\n        item.call(this); // 声明周期的this永远指向实例\r\n    })\r\n}\r\n\r\n/**\r\n * 组件合并策略\r\n */\r\nstrategys.components = function (parentVal, childVal) {\r\n    // childVal.__proto__ = parentVal\r\n    let res = Object.create(parentVal)\r\n    if (childVal) {\r\n        for (let key in childVal) {\r\n            res[key] = childVal[key]\r\n        }\r\n    }\r\n    return res\r\n}","import {patch} from \"./vdom/patch\";\r\nimport {Watcher} from \"./observe/watcher\";\r\nimport {callHook} from \"./globalAPI\";\r\n\r\nexport function mountComponent(vm) {\r\n    let updateCpmponent = function () {\r\n        let vNode = vm._render()\r\n        vm._update(vNode)\r\n    }\r\n\r\n    callHook(vm, 'beforeCreate')\r\n    new Watcher(vm, updateCpmponent, () => {\r\n        // TODO: 添加生命周期\r\n    })\r\n    callHook(vm, 'mounted')\r\n}\r\n\r\nexport function lifCycleMixin(Vue) {\r\n    Vue.prototype._update = function (vnode) {\r\n        const vm = this;\r\n        let prevVnode = vm._prevVode\r\n        vm._prevVode = vnode\r\n        if (!prevVnode) {\r\n            vm.$el = patch(vm.$el, vnode);\r\n        }else {\r\n            vm.$el = patch(prevVnode, vnode);\r\n        }\r\n    }\r\n}","import {initState} from \"./state\";\r\nimport {compilerToFunction} from \"./compiler\";\r\nimport {mountComponent} from \"./lifeCycle\";\r\nimport {nextTick} from \"./async/nextTick\";\r\nimport {mergeOptions} from \"./globalAPI\";\r\n\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        let vm = this\r\n        // vm.$options = options\r\n        // 合并:全局属性+组件属性\r\n        vm.$options = mergeOptions(vm.constructor.options, options);\r\n\r\n        initState(vm)\r\n\r\n        if (vm.$options.el) {\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mount = function (el) {\r\n        let vm = this\r\n        vm.$el = document.querySelector(el)\r\n\r\n        let opts = vm.$options\r\n        if (!opts.render) {\r\n            let html = opts.template || vm.$el.outerHTML\r\n            opts.render = compilerToFunction(html)\r\n        }\r\n\r\n        mountComponent(vm)\r\n    }\r\n\r\n    Vue.prototype.$nextTick = nextTick\r\n}","import {createVnodeEle, createVnodeText} from \"./vdom\";\r\nimport {isObject} from \"./utils/utils\";\r\n\r\nexport function renderMixin(Vue) {\r\n    /**\r\n     * render => vnode\r\n     */\r\n    Vue.prototype._render = function () {\r\n        let vm = this\r\n        let {render} = vm.$options\r\n        let vnode = render.call(vm)\r\n        return vnode\r\n    }\r\n    Vue.prototype._c = function () {\r\n        let vm = this\r\n        return createVnodeEle(vm, ...arguments)\r\n    }\r\n    Vue.prototype._v = function (text) {\r\n        let vm = this\r\n        return createVnodeText(vm, text)\r\n    }\r\n    Vue.prototype._s = function (data) {\r\n        if (isObject(data)) return JSON.stringify(data)\r\n        return data\r\n    }\r\n}","import {initMixin} from \"./init\";\r\nimport {renderMixin} from \"./render\";\r\nimport {lifCycleMixin} from \"./lifeCycle\";\r\nimport {initGlobalAPI} from \"./globalAPI\";\r\nimport {compilerToFunction} from \"./compiler\";\r\nimport {patch, createElm} from \"./vdom/patch\";\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\n// 扩展原型\r\ninitMixin(Vue)\r\nrenderMixin(Vue)\r\nlifCycleMixin(Vue)\r\ninitGlobalAPI(Vue)\r\n\r\n// let vm = new Vue({\r\n//     data() {\r\n//         return { name: \"lang\" }\r\n//     }\r\n// })\r\n// let render = compilerToFunction(`<div>\r\n//     <li key=\"a\">a</li>\r\n//     <li key=\"b\">b</li>\r\n//     <li key=\"c\">c</li>\r\n//     <li key=\"d\">d</li>\r\n// </div>`);\r\n// let oldVnode = render.call(vm);\r\n// let el = createElm(oldVnode); // 真实节点\r\n// document.body.appendChild(el);\r\n//\r\n// vm.name = 'lang02'\r\n// let render2 = compilerToFunction(`<div>\r\n//     <li key=\"f\">f</li>\r\n//     <li key=\"b\">b</li>\r\n//     <li key=\"a\">a</li>\r\n//     <li key=\"g\">g</li>\r\n// </div>`);\r\n// let newVnode = render2.call(vm);\r\n// setTimeout(() => {\r\n//     patch(oldVnode, newVnode);\r\n//\r\n//     // let el2 = createEle(newVnode);\r\n//     // document.body.removeChild(el1);\r\n//     // document.body.appendChild(el2);\r\n//     // 以上是还没做diff的\r\n// },3000)\r\n\r\nexport default Vue\r\n\r\n"],"names":["isFunction","val","isObject","isArray","Array","oldArrayPrototype","prototype","arrayMethods","Object","create","methods","forEach","method","args","apply","addElement","slice","__ob__","observeArray","dep","notify","id","Dep","constructor","watchers","depend","target","addDep","addWatcher","watcher","push","update","observe","data","Observer","defineProperty","value","enumerable","__proto__","walk","keys","key","definedReactive","arr","innerOb","get","dependArray","set","newValue","i","length","current","initState","vm","opts","$options","initData","_data","proxy","source","v","ncname","qnameCapture","startTagOpen","RegExp","attribute","startTagClose","endTagReg","parserHTML","html","root","stack","idx","indexOf","startTag","parseStartTag","start","endTag","match","end","advance","content","substring","text","len","result","tagName","attrs","attr","name","parent","element","createASTElement","children","pop","tag","console","log","replace","type","defaultTagRE","astGenerateCode","ast","genChildren","code","genProps","undefined","item","styles","trim","JSON","stringify","map","gen","join","subAst","test","lastIndex","low","exec","fast","index","compilerToFunction","render","Function","createVnodeEle","isReservedTag","Ctor","components","createComponent","vnode","createVnodeText","componentOptions","isSameNode","oldVnode","newVnode","makeMap","str","tagList","split","includes","_base","extend","hook","init","component","componentInstance","$mount","prepatch","insert","destroy","vNode","patch","createElm","nodeType","parentNode","realDom","insertBefore","nextSibing","removeChild","el","replaceChild","textContent","createElmProp","oldChildren","newChildren","innerHTML","child","appendChild","updateChildren","createComponentElm","$el","document","createElement","createTextNode","oldProps","newProps","newStyle","style","oldStyle","s","setAttribute","removeAttribute","oldStartIndex","oldStartVnode","oldEndIndex","oldEndVnode","newStartIndex","newStartVnode","newEndIndex","newEndVnode","mapping","makeKeyByIndex","nextSibling","moveIndex","moveVnode","anchor","queue","free","nextTick","fn","Promise","resolve","then","flushSchedulerQueue","ids","Set","queueWatcher","has","add","run","clear","Watcher","updateCpmponent","cb","getter","depIds","deps","depId","initGlobalAPI","Vue","options","mixin","mergeOptions","definition","opt","Super","Sub","_init","filter","directive","parentVal","childVal","mergeFiled","hasOwnProperty","strategy","strategys","lifeCycle","concat","callHook","handlers","call","res","mountComponent","_render","_update","lifCycleMixin","prevVnode","_prevVode","initMixin","querySelector","template","outerHTML","$nextTick","renderMixin","_c","arguments","_v","_s"],"mappings":"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"}