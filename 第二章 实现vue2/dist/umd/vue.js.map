{"version":3,"file":"vue.js","sources":["../../src/utils/utils.js","../../src/observe/array.js","../../src/observe/dep.js","../../src/observe/index.js","../../src/state.js","../../src/compiler/parserHTML.js","../../src/compiler/astGenerateCode.js","../../src/compiler/index.js","../../src/vdom/index.js","../../src/vdom/patch.js","../../src/async/nextTick.js","../../src/observe/schedule.js","../../src/observe/watcher.js","../../src/globalAPI/index.js","../../src/lifeCycle.js","../../../第九章 Test/ZF_001.impl_vue01/src/utils.js","../../src/init.js","../../src/render.js","../../src/index.js"],"sourcesContent":["export function isFunction(val) {\r\n    return typeof val === \"function\";\r\n}\r\n\r\nexport function isObject(val) {\r\n    return typeof val === \"object\" && val !== null;\r\n}\r\n\r\nexport function isArray(val) {\r\n    return Array.isArray(val);\r\n}\r\n","let oldArrayPrototype = Array.prototype\r\nexport let arrayMethods = Object.create(oldArrayPrototype)\r\nlet methods = [\"push\", \"pop\", \"unshift\", \"shift\", \"reverse\", \"sort\", \"splice\",]\r\nmethods.forEach((method) => {\r\n    arrayMethods[method] = function (...args) {\r\n        oldArrayPrototype[method].apply(this, args)\r\n        // 对增加的元素进行监听\r\n        let addElement = null\r\n        switch (method) {\r\n            case \"splice\":\r\n                addElement = args.slice(2)\r\n                break;\r\n            case \"push\":\r\n            case \"unshift\":\r\n                addElement = args\r\n                break;\r\n        }\r\n        addElement && this.__ob__.observeArray(addElement)\r\n        this.__ob__.dep.notify()\r\n    }\r\n})","let id = 0\r\nexport class Dep {\r\n    constructor() {\r\n        this.id = id++\r\n        this.watchers = []\r\n    }\r\n    depend() {\r\n        Dep.target.addDep(this)\r\n    }\r\n    // addSub方法,改一下名好辨识\r\n    addWatcher(watcher) {\r\n        this.watchers.push(watcher)\r\n    }\r\n    notify() {\r\n        this.watchers.forEach(watcher => watcher.update())\r\n    }\r\n}\r\nDep.target = null","import {isArray, isObject} from \"../utils/utils\";\r\nimport {arrayMethods} from \"./array\";\r\nimport {Dep} from \"./dep\";\r\n\r\nexport function observe(data) {\r\n    if (!isObject(data)) return\r\n    if (data.__ob__) return\r\n    return new Observer(data)\r\n}\r\n\r\nclass Observer {\r\n    constructor(data) {\r\n        // 添加dep保存在__ob__下,方便对象和数组调用而已。\r\n        // 数组原本没存dep(对比上一条git),而对象是原本就有(现在加多一个__ob__.dep能添加属性的时候用)\r\n        this.dep = new Dep()\r\n        Object.defineProperty(data, \"__ob__\", {\r\n            value: this,\r\n            enumerable: false\r\n        })\r\n        if (isArray(data)) {\r\n            data.__proto__ = arrayMethods\r\n            this.observeArray(data)\r\n        }else {\r\n            this.walk(data)\r\n        }\r\n    }\r\n    walk(data) {\r\n        Object.keys(data).forEach((key) => {\r\n            definedReactive(data, key, data[key])\r\n        })\r\n    }\r\n    observeArray(arr) {\r\n        arr.forEach(observe)\r\n    }\r\n}\r\n\r\n/**\r\n * 性能问题1: 对象嵌套太多会影响性能\r\n * @param data\r\n * @param key\r\n * @param value\r\n * @returns {*}\r\n */\r\nfunction definedReactive(data, key, value) {\r\n    let dep = new Dep()\r\n    let innerOb = observe(value)\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            if (Dep.target) {\r\n                dep.depend()\r\n                if (innerOb) {\r\n                    innerOb.dep.depend()\r\n                    if (isArray(value)) {\r\n                        dependArray(value);\r\n                    }\r\n                }\r\n            }\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return;\r\n            if (isObject(newValue)) { observe(newValue) }\r\n            value = newValue\r\n            dep.notify()\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * 边界问题处理:\r\n * 问题: 页面使用{{arr}};  data:{ arr = [[]] }; 进行修改arr[0].push(100)发现没触发更新\r\n * 解答: 这时只对arr最外层数组的__ob__.dep搜集了watcher, arr[0]没有搜集watcher,\r\n *       所以要递归给内部的也加上外部的watcher\r\n */\r\nfunction dependArray(arr) {\r\n    for(let i = 0; i < arr.length;i++){\r\n        let current = arr[i];\r\n        current.__ob__ && current.__ob__.dep.depend(); // 依赖收集\r\n        if(isArray(current)) {\r\n            dependArray(current);\r\n        }\r\n    }\r\n}","import {isFunction} from \"./utils/utils\";\r\nimport {observe} from \"./observe\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options\r\n\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data\r\n    data = vm._data = isFunction(data) ? data() : data\r\n    observe(data)\r\n\r\n    for (let key in data) {\r\n        proxy(vm, key, \"_data\")\r\n    }\r\n}\r\n\r\n/**\r\n * 易混淆: 这里是将“options的data”代理到实例 和 new Vue(options)的options没任何关联, options的任何属性都不会挂载到实例\r\n * @param vm\r\n * @param key\r\n * @param source\r\n * @returns {*}\r\n */\r\nfunction proxy(vm, key, source) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[source][key]\r\n        },\r\n        set(v) {\r\n            vm[source][key] = v\r\n        }\r\n    })\r\n}","// 用\"html\".match(new RegExp(ncname))匹配\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名，子模块aaa-bbb\r\n/*[\r\n    0: \"aa-bb\"\r\n    groups: undefined\r\n    index: 1\r\n    input: \"<aa-bb>2131</aa-bb>\"\r\n    length: 1\r\n]*/\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // 命名空间标签，aa:aa-xxx。很少用\r\n/*[\r\n    0: \"aa-bb\"\r\n    1: \"aa-bb\"\r\n    groups: undefined\r\n    index: 1\r\n    input: \"<aa-bb>2131</aa-bb>>\"\r\n    length: 2\r\n]*/\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // <标签名和标签名，0: <aa:aa-xxx或<aa-aa, 1: aa:aa-xxx或aa-aa\r\n/*[\r\n    0: \"<aa-bb\"\r\n    1: \"aa-bb\"\r\n    groups: undefined\r\n    index: 0\r\n    input: \"<aa-bb>2131</aa-bb>\"\r\n    length: 2\r\n]*/\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 属性\r\n/*{\r\n    0: \"title = 123\"    // 完整字符串\r\n    1: \"title\"      // key\r\n    2: \"=\"          // 等号\r\n    3: undefined    // 双引号\r\n    4: undefined    // 单引号\r\n    5: \"123\"        // 无引号\r\n    groups: undefined\r\n    index: 0\r\n    input: \"title = 123></aa-bb>\"\r\n    length: 6\r\n}*/\r\nconst startTagClose = /^\\s*(\\/?)>/; // 标签结束, >或/>\r\n/*{\r\n    0: \"/>\"\r\n    1: \"/\"\r\n    groups: undefined\r\n    index: 0\r\n    input: \"/>32323\"\r\n    length: 2\r\n}*/\r\n// const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // // 文本, {{message}}\r\n/*{\r\n    0: \"{{message}}\"\r\n    length: 1\r\n}*/\r\nconst endTagReg = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 标签结束 0: </aa-bb>, 1: aa-bb\r\n/*{\r\n    0: \"</aa-bb>\"\r\n    1: \"aa-bb\"\r\n    groups: undefined\r\n    index: 0\r\n    input: \"</aa-bb>\"\r\n    length: 2\r\n}*/\r\n\r\nexport function parserHTML(html) {\r\n    let root = null\r\n    let stack = [] // 利用入栈/出栈来 对应 开始标签/结束标签, 来完善root\r\n    while(html) {\r\n        let idx = html.indexOf(\"<\")\r\n        // 开始标签/结束标签\r\n        if (idx === 0) {\r\n            let startTag = parseStartTag()\r\n            if (startTag) {\r\n                start(startTag)\r\n                continue;\r\n            }\r\n            let endTag\r\n            if (endTag = html.match(endTagReg)) {\r\n                end(endTag[1])\r\n                advance(endTag[0].length)\r\n            }\r\n        }\r\n        // 内容\r\n        if (idx > 0) {\r\n            let content = html.substring(0, idx);\r\n            text(content);\r\n            advance(content.length);\r\n        }\r\n    }\r\n    function advance(len) {\r\n        html = html.substring(len)\r\n    }\r\n    function parseStartTag() {\r\n        let match = html.match(startTagOpen)\r\n        if (!match) { return false }\r\n        advance(match[0].length)\r\n\r\n\r\n        let result = {\r\n            tagName: match[1],\r\n            attrs: []\r\n        }\r\n        let end,\r\n            attr;\r\n        while(!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n            result.attrs.push({\r\n                name: attr[1],\r\n                value: attr[3] || attr[4] || attr[5]\r\n            })\r\n            advance(attr[0].length)\r\n        }\r\n        if (end) {\r\n            advance(end[0].length)\r\n        }\r\n        return result\r\n    }\r\n    function start({tagName, attrs}) {\r\n        let parent = stack[stack.length - 1]\r\n        let element = createASTElement(tagName, attrs, parent)\r\n        if (parent) {\r\n            parent.children.push(element)\r\n        }\r\n        if (root === null) {\r\n            root = element\r\n        }\r\n        stack.push(element)\r\n    }\r\n    function end(tagName) {\r\n        if (stack.pop().tag !== tagName) {\r\n            console.log(`闭合标签和开始标签不匹配`)\r\n        }\r\n    }\r\n    function text(content) {\r\n        let parent = stack[stack.length - 1]\r\n        content = content.replace(/\\s/g, '')\r\n        if (content) {\r\n            parent.children.push({\r\n                text: content,\r\n                type: 2\r\n            })\r\n        }\r\n    }\r\n    function createASTElement(tag, attrs, parent) {\r\n        return {\r\n            tag,\r\n            attrs,\r\n            parent,\r\n            type: 1,\r\n            children: []\r\n        }\r\n    }\r\n\r\n    return root\r\n}\r\n\r\n","let defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配文本, {{message}}\r\n/*{\r\n    0: \"{{message}}\"\r\n    length: 1\r\n}*/\r\n\r\nexport function astGenerateCode(ast) {\r\n    let children = genChildren(ast)\r\n    let code = \r\n        `_c(\"${ast.tag}\",\r\n            ${\r\n                ast.attrs.length ? genProps(ast.attrs) : undefined\r\n            },\r\n            ${\r\n                children ? `${children}` : \"\"\r\n            }\r\n        )`\r\n    return code\r\n}\r\nfunction genProps(attr) {\r\n    let result = \"\"\r\n    attr.forEach(item => {\r\n        if (item.name === 'style') {\r\n            let styles = {}\r\n            item.value.replace(/([^;:]+):([^;:]+)/g, (...args) => {\r\n                styles[args[1]] = args[2].trim()\r\n            })\r\n            item.value = styles\r\n        }\r\n        result += `${item.name}:${JSON.stringify(item.value)},`\r\n    })\r\n    return `{${result.slice(0,-1)}}`\r\n}\r\nfunction genChildren(ast) {\r\n    let children = ast.children\r\n    if (children) {\r\n        return children.map(gen).join(\",\")\r\n    }\r\n    return false\r\n}\r\nfunction gen(subAst) {\r\n    if (subAst.type === 1) {\r\n        return astGenerateCode(subAst)\r\n    }else {\r\n        let text = subAst.text\r\n        if (!defaultTagRE.test(text)) return `_v(\"${text}\")`\r\n        defaultTagRE.lastIndex = 0\r\n\r\n        let result = []\r\n        let low = 0\r\n        let match;\r\n        while(match = defaultTagRE.exec(text)) {\r\n            let fast = match.index\r\n            if (fast > low) {\r\n                result.push(JSON.stringify(text.slice(low, fast)))\r\n            }\r\n            result.push(`_s(${match[1].trim()})`)\r\n            low = fast + match[0].length\r\n        }\r\n        if (low < text.length) {\r\n            result.push(JSON.stringify(text.slice(low)))\r\n        }\r\n        return `_v(${result.join('+')})`\r\n    }\r\n}","import {parserHTML} from \"./parserHTML\";\r\nimport {astGenerateCode} from \"./astGenerateCode\";\r\n\r\nexport function compilerToFunction(html) {\r\n    let ast = parserHTML(html)\r\n\r\n    let code = astGenerateCode(ast)\r\n\r\n    let render = new Function(`with(this) { return ${code} }`)\r\n\r\n    return render\r\n}","export function createVnodeEle(vm, tag, data = {}, ...children) {\r\n    return vnode(vm, tag, data, children, data.key, undefined)\r\n}\r\nexport function createVnodeText(vm, text) {\r\n    return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\nfunction vnode(vm, tag, data = {}, children, key, text) {\r\n    return {\r\n        vm,\r\n        tag,\r\n        data,\r\n        children,\r\n        key,\r\n        text\r\n    }\r\n}\r\n\r\nexport function isSameNode(oldVnode, newVnode) {\r\n    return (oldVnode.tag === newVnode.tag) && (oldVnode.key == newVnode.key)\r\n}","/**\r\n * vnode => real dom\r\n */\r\nimport {isObject} from \"../utils/utils\";\r\nimport {isSameNode} from \"./index\";\r\n\r\nexport function patch(oldVnode, newVnode) {\r\n    if (oldVnode.nodeType) {\r\n        let parentNode = oldVnode.parentNode\r\n        let realDom = createElm(newVnode)\r\n        parentNode.insertBefore(realDom, oldVnode.nextSibing);\r\n        parentNode.removeChild(oldVnode);\r\n        return realDom\r\n    }else {\r\n        // 节点不同\r\n        if (!isSameNode(oldVnode, newVnode)) {\r\n            oldVnode.el.parentNode.replaceChild(createElm(newVnode), oldVnode.el)\r\n        }\r\n\r\n        // 节点相同\r\n        let el = newVnode.el = oldVnode.el\r\n        if (!oldVnode.tag) {\r\n            if (oldVnode.text !== newVnode.text) {\r\n                return el.textContent = newVnode.text\r\n            }\r\n        }\r\n        createElmProp(newVnode, oldVnode.data)\r\n        let oldChildren = oldVnode.children || []   // 比较儿子\r\n        let newChildren = newVnode.children || []\r\n        if (oldChildren.length && !newChildren.length) {\r\n            el.innerHTML = ''\r\n        }else if (!oldChildren.length && newChildren.length) {\r\n            newChildren.forEach(child => el.appendChild(createElm(child)))\r\n        }else {\r\n            updateChildren(el, oldChildren, newChildren)\r\n        }\r\n\r\n    }\r\n}\r\nexport function createElm(vnode) {\r\n    let {vm, tag, data, children, text} = vnode\r\n    if (tag) {\r\n        // 在vnode.el都存了真实dom\r\n        vnode.el = document.createElement(tag)\r\n        createElmProp(vnode, data)\r\n        children.forEach(child => {\r\n            vnode.el.appendChild(createElm(child))\r\n        })\r\n    }else {\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n    return vnode.el\r\n}\r\nfunction createElmProp(newVnode, oldProps={}) {\r\n    let el = newVnode.el\r\n    let newProps = newVnode.data || {}\r\n\r\n    let newStyle = newProps.style || {}\r\n    let oldStyle = oldProps.style || {}\r\n    for (let key in oldStyle) {\r\n        if (!newStyle[key]) {\r\n            el.style[key] = \"\"\r\n        }\r\n    }\r\n\r\n    for (let key in newProps) {\r\n        if (key === 'style') {\r\n            for (let s in newStyle) {\r\n                el.style[s] = newStyle[s]\r\n            }\r\n        }else {\r\n            el.setAttribute(key, newProps[key])\r\n        }\r\n    }\r\n    for (let key in oldProps) {\r\n        if (!newProps[key]) {\r\n            el.removeAttribute(key)\r\n        }\r\n    }\r\n}\r\nfunction updateChildren(el, oldChildren, newChildren) {\r\n    let oldStartIndex = 0\r\n    let oldStartVnode = oldChildren[0]\r\n    let oldEndIndex = oldChildren.length - 1\r\n    let oldEndVnode = oldChildren[oldEndIndex]\r\n    let newStartIndex = 0\r\n    let newStartVnode = newChildren[0]\r\n    let newEndIndex = newChildren.length - 1\r\n    let newEndVnode = newChildren[newEndIndex]\r\n    // 头头、尾尾、头尾、尾头、乱序\r\n    while((oldStartIndex <= oldEndIndex) && (newStartIndex <= newEndIndex)) {\r\n        if (isSameNode(oldStartVnode,newStartVnode)) {\r\n            patch(oldStartVnode, newStartVnode) // 递归对比子元素\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }else if (isSameNode(oldEndVnode, newEndVnode)) {\r\n            patch(oldEndVnode, newEndVnode)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newEndVnode = newChildren[--newEndIndex]\r\n        }else if (isSameNode(oldStartVnode, newEndVnode)) {\r\n            patch(oldStartVnode, newEndVnode)\r\n            el.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling)\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newEndVnode = oldChildren[--newEndIndex]\r\n        }else if (isSameNode(oldEndVnode, newStartVnode)) {\r\n            patch(oldEndVnode, newStartVnode)\r\n            el.insertBefore(oldEndVnode.el, newStartVnode.el)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }else {\r\n\r\n        }\r\n    }\r\n    if (newStartIndex <= newEndIndex) {\r\n        for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n            let anchor = newChildren[newEndIndex + 1] ? newChildren[newEndIndex + 1].el : null\r\n            el.insertBefore(createElm(newChildren[i]), anchor)\r\n        }\r\n    }\r\n    if (oldStartIndex <= oldEndIndex) {\r\n        for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n            let child = oldChildren[i]\r\n            el.removeChild(child.el)\r\n        }\r\n    }\r\n}","let queue = []\r\nlet free = true\r\n\r\nexport function nextTick(fn) {\r\n    queue.push(fn)\r\n    if (free) {\r\n        Promise.resolve().then(flushSchedulerQueue)\r\n        free = false\r\n    }\r\n}\r\nfunction flushSchedulerQueue() {\r\n    queue.forEach(fn => fn())\r\n    queue = []\r\n    free = true\r\n}","import {nextTick} from \"../async/nextTick\";\r\n\r\nlet ids = new Set()\r\nlet queue = []\r\nlet free = true\r\n\r\n/**\r\n * 和防抖有些不同,\r\n * 这里是把render放到微任务,等同步代码执行完, 然后就会执行render\r\n */\r\nexport function queueWatcher(watcher) {\r\n    let id = watcher.id\r\n    if (!ids.has(id)) {\r\n        ids.add(id)\r\n        queue.push(watcher)\r\n    }\r\n    if (free) {\r\n        nextTick(flushSchedulerQueue)\r\n        free = false\r\n    }\r\n}\r\nfunction flushSchedulerQueue() {\r\n    queue.forEach(watcher => watcher.run())\r\n    ids.clear()\r\n    queue = []\r\n    free = true\r\n}","import {Dep} from \"./dep\";\r\nimport {queueWatcher} from \"./schedule\";\r\n\r\nlet id = 0\r\nexport class Watcher {\r\n    constructor(vm, updateCpmponent, cb) {\r\n        this.id = id++;\r\n        this.vm = vm;\r\n        this.getter = updateCpmponent;\r\n        this.cb = cb;\r\n        this.depIds = new Set();\r\n        this.deps = [];\r\n\r\n        this.get();\r\n    }\r\n    get() {\r\n        Dep.target = this\r\n        this.getter()\r\n        Dep.target = null\r\n    }\r\n    addDep(dep) {\r\n        let depId = dep.id\r\n        if (!this.depIds.has(depId)) {\r\n            this.depIds.add(depId)\r\n            this.deps.push(dep)\r\n            dep.addWatcher(this)\r\n        }\r\n    }\r\n    update() {\r\n        // 快速修改多次值会导致render多次\r\n        // this.get()\r\n        queueWatcher(this)\r\n    }\r\n    run() {\r\n        this.get()\r\n        // FIXME: 会再出发一次依赖收集, 有优化空间?\r\n    }\r\n}","import {isArray} from \"../utils/utils\";\r\n\r\n/**\r\n * 将全局属性都放到对应队列里，方便初始化子组件时进行属性合并\r\n * @param Vue\r\n */\r\nexport function initGlobalAPI(Vue) {\r\n    Vue.options = {}\r\n    Vue.mixin = function (options) {\r\n        this.options = mergeOptions(this.options, options)\r\n    }\r\n    Vue.component = function () {}\r\n    Vue.filter = function () {}\r\n    Vue.directive = function () {}\r\n}\r\n\r\n/**\r\n * 类似Object.assign,将全局属性组合起来\r\n * @param parentVal\r\n * @param childVal\r\n * @returns {{}}\r\n */\r\nexport function mergeOptions(parentVal, childVal) {\r\n    const options = {};\r\n    for(let key in parentVal) {\r\n        mergeFiled(key);\r\n    }\r\n    for(let key in childVal) {\r\n        if(!parentVal.hasOwnProperty(key)) {\r\n            mergeFiled(key);\r\n        }\r\n    }\r\n    function mergeFiled(key) {\r\n        let strategy = strategys[key];\r\n        if(strategy) {\r\n            options[key] = strategy(parentVal[key], childVal[key]);\r\n        }else {\r\n            options[key] = childVal[key] || parentVal[key];\r\n        }\r\n    }\r\n\r\n    return options;\r\n}\r\n\r\n/**\r\n * 生命周期函数(使用队列存储)\r\n * @type {{}}\r\n */\r\nlet strategys = {};\r\nlet lifeCycle = [\r\n    \"beforeCreate\",\r\n    \"created\",\r\n    \"beforeMount\",\r\n    \"mounted\"\r\n];\r\nlifeCycle.forEach(hook => {\r\n    strategys[hook] = function(parentVal, childVal) {\r\n        if(childVal) {\r\n            if(parentVal) {\r\n                return parentVal.concat(childVal);\r\n            }else {\r\n                if(isArray(childVal)) {\r\n                    return childVal\r\n                }\r\n                return isArray(childVal) ? childVal : [childVal];\r\n            }\r\n        }else {\r\n            return parentVal;\r\n        }\r\n    }\r\n})\r\n\r\n/**\r\n * 暴露声明周期函数\r\n * @param vm\r\n * @param hook\r\n */\r\nexport function callHook(vm, hook) {\r\n    let handlers = vm.$options[hook];\r\n    handlers && handlers.forEach(item => {\r\n        item.call(this); // 声明周期的this永远指向实例\r\n    })\r\n}","import {patch} from \"./vdom/patch\";\r\nimport {Watcher} from \"./observe/watcher\";\r\nimport {callHook} from \"./globalAPI\";\r\n\r\nexport function mountComponent(vm) {\r\n    let updateCpmponent = function () {\r\n        let vNode = vm._render()\r\n        vm._update(vNode)\r\n    }\r\n\r\n    callHook(vm, 'beforeCreate')\r\n    new Watcher(vm, updateCpmponent, () => {\r\n        // FIXME: 依赖收集完成并进行了初次渲染\r\n    })\r\n    callHook(vm, 'mounted')\r\n}\r\n\r\nexport function lifCycleMixin(Vue) {\r\n    Vue.prototype._update = function (vnode) {\r\n        const vm = this;\r\n        vm.$el = patch(vm.$el, vnode);\r\n    }\r\n}","export function isFunction(val) {\r\n    return typeof val === \"function\";\r\n}\r\n\r\nexport function isObject(val) {\r\n    return typeof val === \"object\" && val !== null;\r\n}\r\n\r\nexport function isArray(val) {\r\n    return Array.isArray(val);\r\n}\r\n\r\nlet callbacks = [];\r\nlet waiting = false;\r\nexport function nextTick(fn) {\r\n    callbacks.push(fn);\r\n    if (!waiting) {\r\n        Promise.resolve().then(flushCallbacks);\r\n        waiting = true;\r\n    }\r\n}\r\nfunction flushCallbacks() {\r\n    callbacks.forEach(fn => fn());\r\n    callbacks = [];\r\n    waiting = false;\r\n}\r\n\r\n// 第一次合并： {} {beforeCreate: fn} => {beforeCreate: [fn]}\r\n// 第二次合并:  {beforeCreate: [fn]} {beforeCreate: fn} => {beforeCreate: [fn, fn]}\r\nlet strategys = {}; // 存储所有策略\r\nlet lifeCycle = [\"beforeCreate\", \"created\", \"beforeMount\", \"Mounted\"];\r\nlifeCycle.forEach(hook => {\r\n    strategys[hook] = function(parentVal, childVal) {\r\n        if(childVal) {\r\n            if(parentVal) {\r\n                return parentVal.concat(childVal); // 看上面的第二次合并，parentVal已经是数组\r\n            }else {\r\n                if(isArray(childVal)) {\r\n                    return childVal\r\n                }\r\n                return [childVal];\r\n            }\r\n        }else {\r\n            return parentVal;\r\n        }\r\n    }\r\n})\r\n\r\n\r\nexport function mergeOptions(parentVal, childVal) {\r\n    const options = {};\r\n    // 合并全局属性和组件属性(options)\r\n    for(let key in parentVal) {\r\n        mergeFiled(key);\r\n    }\r\n\r\n    // 添加组件属性\r\n    for(let key in childVal) {\r\n        if(!parentVal.hasOwnProperty(key)) {\r\n            mergeFiled(key);\r\n        }\r\n    }\r\n\r\n    function mergeFiled(key) {\r\n        let strat = strategys[key];\r\n        if(strat) {\r\n            options[key] = strat(parentVal[key], childVal[key]); // 合并生命周期\r\n        }else {\r\n            options[key] = childVal[key] || parentVal[key]; // 合并data那些\r\n        }\r\n    }\r\n\r\n    return options;\r\n}","import {initState} from \"./state\";\r\nimport {compilerToFunction} from \"./compiler\";\r\nimport {mountComponent} from \"./lifeCycle\";\r\nimport {nextTick} from \"./async/nextTick\";\r\nimport {mergeOptions} from \"../../第九章 Test/ZF_001.impl_vue01/src/utils\";\r\n\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        let vm = this\r\n        // vm.$options = options\r\n        // 合并:全局属性+组件属性(如Vue.mixin内的数据和方法)\r\n        vm.$options = mergeOptions(vm.constructor.options, options);\r\n\r\n        initState(vm)\r\n\r\n        if (vm.$options.el) {\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mount = function (el) {\r\n        let vm = this\r\n        vm.$el = document.querySelector(el)\r\n\r\n        let opts = vm.$options\r\n        if (!opts.render) {\r\n            let html = opts.template || vm.$el.outerHTML\r\n            opts.render = compilerToFunction(html)\r\n        }\r\n\r\n        mountComponent(vm)\r\n    }\r\n\r\n    Vue.prototype.$nextTick = nextTick\r\n}","import {createVnodeEle, createVnodeText} from \"./vdom\";\r\nimport {isObject} from \"./utils/utils\";\r\n\r\nexport function renderMixin(Vue) {\r\n    /**\r\n     * render => vnode\r\n     */\r\n    Vue.prototype._render = function () {\r\n        let vm = this\r\n        let {render} = vm.$options\r\n        let vnode = render.call(vm)\r\n        return vnode\r\n    }\r\n    Vue.prototype._c = function () {\r\n        let vm = this\r\n        return createVnodeEle(vm, ...arguments)\r\n    }\r\n    Vue.prototype._v = function (text) {\r\n        let vm = this\r\n        return createVnodeText(vm, text)\r\n    }\r\n    Vue.prototype._s = function (data) {\r\n        if (isObject(data)) return JSON.stringify(data)\r\n        return data\r\n    }\r\n}","import {initMixin} from \"./init\";\r\nimport {renderMixin} from \"./render\";\r\nimport {lifCycleMixin} from \"./lifeCycle\";\r\nimport {initGlobalAPI} from \"./globalAPI\";\r\nimport {compilerToFunction} from \"./compiler\";\r\nimport {patch, createElm} from \"./vdom/patch\";\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\n// 扩展原型\r\ninitMixin(Vue)\r\nrenderMixin(Vue)\r\nlifCycleMixin(Vue)\r\ninitGlobalAPI(Vue)\r\n\r\nlet vm = new Vue({\r\n    data() {\r\n        return { name: \"lang\" }\r\n    }\r\n})\r\nlet render = compilerToFunction(`<div>\r\n    <li key=\"a\">a</li>\r\n    <li key=\"b\">b</li>\r\n    <li key=\"c\">c</li>\r\n</div>`);\r\nlet oldVnode = render.call(vm);\r\nlet el = createElm(oldVnode); // 真实节点\r\ndocument.body.appendChild(el);\r\n\r\nvm.name = 'lang02'\r\nlet render2 = compilerToFunction(`<div>\r\n    <li key=\"c\">c</li>\r\n    <li key=\"b\">b</li>\r\n    <li key=\"a\">a</li>\r\n    <li key=\"d\">d</li>\r\n</div>`);\r\nlet newVnode = render2.call(vm);\r\nsetTimeout(() => {\r\n    patch(oldVnode, newVnode);\r\n\r\n    // let el2 = createEle(newVnode);\r\n    // document.body.removeChild(el1);\r\n    // document.body.appendChild(el2);\r\n    // 以上是还没做diff的\r\n},3000)\r\n\r\nexport default Vue\r\n\r\n"],"names":["isFunction","val","isObject","isArray","Array","oldArrayPrototype","prototype","arrayMethods","Object","create","methods","forEach","method","args","apply","addElement","slice","__ob__","observeArray","dep","notify","id","Dep","constructor","watchers","depend","target","addDep","addWatcher","watcher","push","update","observe","data","Observer","defineProperty","value","enumerable","__proto__","walk","keys","key","definedReactive","arr","innerOb","get","dependArray","set","newValue","i","length","current","initState","vm","opts","$options","initData","_data","proxy","source","v","ncname","qnameCapture","startTagOpen","RegExp","attribute","startTagClose","endTagReg","parserHTML","html","root","stack","idx","indexOf","startTag","parseStartTag","start","endTag","match","end","advance","content","substring","text","len","result","tagName","attrs","attr","name","parent","element","createASTElement","children","pop","tag","console","log","replace","type","defaultTagRE","astGenerateCode","ast","genChildren","code","genProps","undefined","item","styles","trim","JSON","stringify","map","gen","join","subAst","test","lastIndex","low","exec","fast","index","compilerToFunction","render","Function","createVnodeEle","vnode","createVnodeText","isSameNode","oldVnode","newVnode","patch","nodeType","parentNode","realDom","createElm","insertBefore","nextSibing","removeChild","el","replaceChild","textContent","createElmProp","oldChildren","newChildren","innerHTML","child","appendChild","updateChildren","document","createElement","createTextNode","oldProps","newProps","newStyle","style","oldStyle","s","setAttribute","removeAttribute","oldStartIndex","oldStartVnode","oldEndIndex","oldEndVnode","newStartIndex","newStartVnode","newEndIndex","newEndVnode","nextSibling","anchor","queue","free","nextTick","fn","Promise","resolve","then","flushSchedulerQueue","ids","Set","queueWatcher","has","add","run","clear","Watcher","updateCpmponent","cb","getter","depIds","deps","depId","initGlobalAPI","Vue","options","mixin","mergeOptions","component","filter","directive","parentVal","childVal","mergeFiled","hasOwnProperty","strategy","strategys","lifeCycle","hook","concat","callHook","handlers","call","mountComponent","vNode","_render","_update","lifCycleMixin","$el","strat","initMixin","_init","$mount","querySelector","template","outerHTML","$nextTick","renderMixin","_c","arguments","_v","_s","body","render2","setTimeout"],"mappings":"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"}