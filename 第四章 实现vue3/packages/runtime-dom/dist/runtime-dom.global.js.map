{"version":3,"file":"runtime-dom.global.js","sources":["../src/nodeOps.ts","../src/modules/class.ts","../src/modules/style.ts","../src/modules/event.ts","../src/modules/attr.ts","../src/patchProp.ts","../../shared/src/index.ts","../../runtime-core/src/vnode.ts","../../runtime-core/src/apiCreateApp.ts","../../runtime-core/src/index.ts","../src/index.ts"],"sourcesContent":["export const nodeOps = {\r\n    createElement(tagName) {\r\n        return document.createElement(tagName)\r\n    },\r\n    remove(child) {\r\n        const parent = child.parentNode\r\n        if (parent) {\r\n            parent.removeChild(child)\r\n        }\r\n    },\r\n    querySelector(selector) {\r\n        return document.querySelector(selector)\r\n    },\r\n    insert(child, parent, anchor = null) {\r\n        parent.insertBefore(child, anchor)\r\n    },\r\n    createText(text) {\r\n        return document.createTextNode(text)\r\n    },\r\n    setElementText(el, text) {\r\n        el.textContent = text; // innerHTML会有风险\r\n    },\r\n    setText(node, text) {\r\n        node.nodeValue = text\r\n    }\r\n}","export function patchClass(el, newValue) {\r\n    if (newValue === null) {\r\n        newValue = ''\r\n    }\r\n    el.className = newValue\r\n}","export function patchStyle(el, oldValue, newValue) {\r\n    const style = el.style\r\n    if (newValue === null) {\r\n        el.removeAttribute('style')\r\n    }else {\r\n        if (oldValue) {\r\n            for (let k in oldValue) {\r\n                if (newValue[k] === null) {\r\n                    style[k] = ''\r\n                }\r\n            }\r\n        }\r\n        for (let k in newValue) {\r\n            style[k] = newValue[k]\r\n        }\r\n    }\r\n}","export function patchEvent(el, key, newValue) {\r\n    const invokers = el._vei || (el._vei = {})  // 缓存起来\r\n    const exists = invokers[key]\r\n    if (exists && newValue) {\r\n        exists.value = newValue\r\n    }else {\r\n        const eventName = key.slice(2).toLowerCase()\r\n        if (newValue) {\r\n            const fn = invokers[key] = createInvoker(newValue)\r\n            el.addEventListener(eventName, fn)\r\n        } else {\r\n            el.removeEventListener(eventName, exists)\r\n        }\r\n    }\r\n}\r\n\r\nfunction createInvoker(fn) {\r\n    const invoker = (e) => { invoker.value(e) }\r\n    invoker.value = fn\r\n    return invoker\r\n}","export function patchAttr(el, key, newValue) {\r\n    if (newValue === null) {\r\n        el.removeAttribute(key)\r\n    }else {\r\n        el.setAttribute(key, newValue)\r\n    }\r\n}","import {patchClass} from \"./modules/class\";\r\nimport {patchStyle} from \"./modules/style\";\r\nimport {patchEvent} from \"./modules/event\";\r\nimport {patchAttr} from \"./modules/attr\";\r\n\r\nexport function patchProp(el, key, oldValue, newValue) {\r\n    switch (key) {\r\n        case 'class':\r\n            patchClass(el, newValue)\r\n            break;\r\n        case 'style':\r\n            patchStyle(el, oldValue, newValue)\r\n            break;\r\n        default:\r\n            if (/^on[a-z]/.test(key)) {\r\n                patchEvent(el, key, newValue)\r\n            }else {\r\n                patchAttr(el, key, newValue)\r\n            }\r\n    }\r\n}","export const isObject = (v) => typeof v === 'object' && v !== null\r\nexport const isArray = Array.isArray\r\nexport const isString = v => typeof v === 'string'\r\n\r\nexport const extend = Object.assign\r\nexport const hasChange = (oldValue, newValue) => oldValue !== newValue\r\nexport const isInteger = (key) => parseInt(key) + '' === key   // 数组的下标\r\nexport const hasOwn = (target, key) => Object.prototype.hasOwnProperty.call(target, key)\r\n\r\nexport const enum ShapeFlags {\r\n    ELEMENT = 1,\r\n    FUNCTIONAL_COMPONENT = 1 << 1,\r\n    STATEFUL_COMPONENT = 1 << 2,\r\n    TEXT_CHILDREN = 1 << 3,\r\n    ARRAY_CHILDREN = 1 << 4,\r\n    SLOTS_CHILDREN = 1 << 5,\r\n    TELEPORT = 1 << 6,\r\n    SUSPENSE = 1 << 7,\r\n    COMPONENT_SHOULD_KEEP_ALIVE = 1 << 8,\r\n    COMPONENT_KEPT_ALIVE = 1 << 9,\r\n    COMPONENT = ShapeFlags.STATEFUL_COMPONENT | ShapeFlags.FUNCTIONAL_COMPONENT\r\n}\r\n","import {isArray, isObject, isString, ShapeFlags} from \"@vue/shared\";\r\n\r\nexport function createVnode(type, props, children = null) {\r\n    let shapeFlag = isString(type) ? ShapeFlags.ELEMENT :\r\n                        isObject(type) ? ShapeFlags.STATEFUL_COMPONENT :\r\n                            0;\r\n    let vnode = {\r\n        __v_isVnode: true,\r\n        type,\r\n        props,\r\n        children,\r\n        el: null,   // 真实节点\r\n        key: props && props.key,\r\n        shapeFlag\r\n    }\r\n    normalizeChildren(vnode, children)\r\n    return vnode\r\n}\r\n\r\nfunction normalizeChildren(vnode, children) {\r\n    if (children === null) {\r\n\r\n    }else if (isArray(children)) {\r\n        vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN\r\n    }else {\r\n        vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN\r\n    }\r\n}","import {createVnode} from \"./vnode\";\r\n\r\nexport function createAppAPI(render) {\r\n    return function createApp(rootComponent, props) {\r\n        let app = {\r\n            _component: rootComponent,\r\n            _rootProps: props,\r\n            _container: null,\r\n            use() {},\r\n            mixin() {},\r\n            component() {},\r\n            mount(container) {\r\n                let vnode = createVnode(rootComponent, props)\r\n                render(vnode, container)\r\n                app._container = container\r\n            }\r\n        }\r\n        return app\r\n    }\r\n}","import {createAppAPI} from \"./apiCreateApp\";\r\n\r\n\r\nexport function createRender(renderOption) {    // renderOption是不同平台传的值不同, 现在是只有dom平台\r\n    // Vnode -> realDOM\r\n    // [而vue2的render是执行_render函数生成Vnode, _update才是Vnode -> realDOM]\r\n    const render = (vnode, container) => {\r\n        patch(null, vnode, container)\r\n    }\r\n    const patch = (vnode1, vnode2, container) => {\r\n        // TODO: 渲染逻辑, diff算法\r\n    }\r\n    return {\r\n        createApp: createAppAPI(render)\r\n    }\r\n}\r\n","/**\r\n * runtime-dom: 主要是对dom的一些操作\r\n */\r\nimport {nodeOps} from './nodeOps'\r\nimport {patchProp} from './patchProp'\r\nimport {extend} from \"@vue/shared\";\r\nimport {createRender} from \"@vue/runtime-core\";\r\n\r\nlet renderOptions = extend(nodeOps, {patchProp})\r\nconsole.log(renderOptions)\r\nexport function createApp(rootComponent, props = null) {\r\n    // core返回createApp和mount, 然后进行dom平台的封装\r\n    const app = createRender(renderOptions).createApp(rootComponent, props)\r\n    let {mount} = app\r\n    app.mount = function (container) {\r\n        container = nodeOps.querySelector(container)\r\n        container.innerHTML = ''\r\n        let proxy = mount(container)\r\n        return proxy\r\n    }\r\n    return app\r\n}\r\nexport function h() {}\r\n"],"names":[],"mappings":"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"}