{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["export const isObject = (v) => typeof v === 'object' && v !== null","import get = Reflect.get;\r\nimport {isObject} from \"@vue/shared\";\r\nimport {reactive, readonly} from \"./reactive\";\r\n\r\nconst reactiveGet = createGet(false, false)\r\nconst shallowReactiveGet = createGet(false, true)\r\nconst readonlyGet = createGet(true, false)\r\nconst shallowReadonlyGet = createGet(true, true)\r\nfunction createGet(isReadonly = false, isShallow = false) {\r\n    // target: 目标对象、key: 需要获取的属性、receiver: 目标对象使用的proxy\r\n    return function get(target, key, receiver) {\r\n        let value = Reflect.get(target, key, receiver)\r\n        if (!isReadonly) {\r\n            // --收集依赖--\r\n        }\r\n        if (isShallow) {\r\n            return value\r\n        }\r\n        if (isObject(value)) {\r\n            return isReadonly ? readonly(value) : reactive(value)   // 递归代理\r\n        }\r\n        return value\r\n    }\r\n}\r\n\r\nconst reactiveSet = createSet()\r\nconst shallowReactiveSet = createSet()\r\nconst readonlySet = createSet()\r\nconst shallowReadonlySet = createSet()\r\nfunction createSet() {\r\n    return function set(target, key, value, receiver) {\r\n        let res = Reflect.set(target, key, value, receiver)\r\n        console.log(`设置值`)\r\n        return res\r\n    }\r\n}\r\n\r\nexport const reactiveHandler = {\r\n    get: reactiveGet,\r\n    set: reactiveSet\r\n}\r\nexport const shallowReactiveHandler = {\r\n    get: shallowReactiveGet,\r\n    set: shallowReactiveSet\r\n}\r\nexport const readonlyHandler = {\r\n    get: readonlyGet,\r\n    set: readonlySet\r\n}\r\nexport const shallowReadonlyHandler = {\r\n    get: shallowReadonlyGet,\r\n    set: shallowReadonlySet\r\n}","import {isObject} from \"@vue/shared\";\r\nimport {reactiveHandler, shallowReactiveHandler, readonlyHandler, shallowReadonlyHandler} from \"./baseHandlers\"\r\n\r\nlet reactiveWeakMap = new WeakMap()\r\nlet shallowReactiveHandlerWeakMap = new WeakMap()\r\nlet readonlyWeakMap = new WeakMap()\r\nlet shallowReadonlyWeakMap = new WeakMap()\r\nexport function reactive(target: object) {\r\n    return createReactiveObject(target, reactiveHandler, reactiveWeakMap)\r\n}\r\nexport function shallowReactive(target: object) {\r\n    return createReactiveObject(target, shallowReactiveHandler, shallowReactiveHandlerWeakMap)\r\n}\r\nexport function readonly(target: object) {\r\n    return createReactiveObject(target, readonlyHandler, readonlyWeakMap)\r\n}\r\nexport function shallowReadonly(target: object) {\r\n    return createReactiveObject(target, shallowReadonlyHandler, shallowReadonlyWeakMap)\r\n}\r\n\r\nfunction createReactiveObject(target, baseHandlers, proxyMap) {\r\n    if (!isObject(target)) return target\r\n\r\n    const exitsProxy = proxyMap.get(target)\r\n    if (exitsProxy) return exitsProxy\r\n\r\n    const proxy = new Proxy(target,  baseHandlers)\r\n    proxyMap.set(target, proxy)\r\n\r\n    return proxy\r\n}"],"names":[],"mappings":"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"}