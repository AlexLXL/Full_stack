{"version":3,"file":"runtime-core.global.js","sources":["../../shared/src/index.ts","../src/vnode.ts","../src/apiCreateApp.ts","../src/component.ts","../src/render.ts"],"sourcesContent":["export const isObject = v => typeof v === 'object' && v !== null\r\nexport const isString = v => typeof v === 'string'\r\nexport const isFunction = v => typeof v === 'function'\r\nexport const isArray = Array.isArray\r\n\r\n\r\nexport const extend = Object.assign\r\nexport const hasChange = (oldValue, newValue) => oldValue !== newValue\r\nexport const isInteger = (key) => parseInt(key) + '' === key   // 数组的下标\r\nexport const hasOwn = (target, key) => Object.prototype.hasOwnProperty.call(target, key)\r\n\r\nexport const enum ShapeFlags {\r\n    ELEMENT = 1,    // 元素\r\n    FUNCTIONAL_COMPONENT = 1 << 1,  // 函数式组件\r\n    STATEFUL_COMPONENT = 1 << 2,    // setup组件\r\n    TEXT_CHILDREN = 1 << 3, // 内容为文本\r\n    ARRAY_CHILDREN = 1 << 4,    // 内容为数组\r\n    SLOTS_CHILDREN = 1 << 5,\r\n    TELEPORT = 1 << 6,\r\n    SUSPENSE = 1 << 7,\r\n    COMPONENT_SHOULD_KEEP_ALIVE = 1 << 8,\r\n    COMPONENT_KEPT_ALIVE = 1 << 9,\r\n    COMPONENT = ShapeFlags.STATEFUL_COMPONENT | ShapeFlags.FUNCTIONAL_COMPONENT\r\n}\r\n","import {isArray, isObject, isString, ShapeFlags} from \"@vue/shared\";\r\n\r\n/**\r\n * 创建虚拟node\r\n * @param type 可能传组件配置setup, 可能传h创建的div\r\n * @param props\r\n * @param children\r\n */\r\nexport function createVnode(type, props, children = null) {\r\n    let shapeFlag = isString(type) ? ShapeFlags.ELEMENT :\r\n                        isObject(type) ? ShapeFlags.STATEFUL_COMPONENT :\r\n                            0;\r\n    let vnode = {\r\n        __v_isVnode: true,\r\n        type,\r\n        props,\r\n        children,\r\n        el: null,   // 真实节点\r\n        key: props && props.key,\r\n        shapeFlag\r\n    }\r\n    normalizeChildren(vnode, children)\r\n    return vnode\r\n}\r\n\r\nfunction normalizeChildren(vnode, children) {\r\n    if (children === null) {\r\n\r\n    }else if (isArray(children)) {\r\n        vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN\r\n    }else {\r\n        vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN\r\n    }\r\n}","import {createVnode} from \"./vnode\";\r\n\r\nexport function createAppAPI(render) {\r\n    return function createApp(rootComponent, props) {\r\n        let app = {\r\n            _component: rootComponent,\r\n            _rootProps: props,\r\n            _container: null,\r\n            use() {},\r\n            mixin() {},\r\n            component() {},\r\n            mount(container) {\r\n                let vnode = createVnode(rootComponent, props)\r\n                render(vnode, container)\r\n                app._container = container\r\n            }\r\n        }\r\n        return app\r\n    }\r\n}","import {hasOwn, isFunction, isObject, ShapeFlags} from \"@vue/shared\";\r\n\r\n/**\r\n * 创建组件实例\r\n * @param vnode\r\n */\r\nexport function createComponentInstance(vnode) {\r\n    let instance = {\r\n        vnode,\r\n        data: {},\r\n        attrs: {},  // 去掉用户使用的props后的结果\r\n        props: {},\r\n        slots: {},\r\n        render: null,\r\n        setupState: {},\r\n        subTree: null,\r\n        isMounted: false,\r\n        bc: null,\r\n        m: null,\r\n        ctx: {},\r\n        proxy: {}\r\n    }\r\n\r\n    instance.ctx = {_: instance}\r\n    return instance\r\n}\r\n\r\n/**\r\n * 添加setup数据到实例\r\n * @param vnode\r\n */\r\nexport function setupComponent(instance) {\r\n    let isStateful = isStatefulComponent(instance.vnode)\r\n    isStateful ? setupStatefulComponent(instance) : undefined\r\n}\r\nfunction isStatefulComponent(vnode) {\r\n    return vnode.shapeFlag & ShapeFlags.STATEFUL_COMPONENT\r\n}\r\nfunction setupStatefulComponent(instance) {\r\n    instance.proxy = new Proxy(instance.ctx, {\r\n        get({_: instance}, key) {\r\n            let {setupState, data, props} = instance\r\n            if (hasOwn(setupState, key)) {\r\n                return setupState[key]\r\n            }else if (hasOwn(data, key)) {\r\n                return data[key]\r\n            }else if (hasOwn(props, key)) {\r\n                return props[key]\r\n            }\r\n        },\r\n        set({_: instance}, key, value) {\r\n            let {setupState, data, props} = instance\r\n            if (hasOwn(setupState, key)) {\r\n                setupState[key] = value\r\n            }else if (hasOwn(data, key)) {\r\n                data[key] = value\r\n            }else if (hasOwn(props, key)) {\r\n                props[key] = value\r\n            }\r\n            return true\r\n        }\r\n    })\r\n\r\n    let Component = instance.vnode.type // 整个组件配置\r\n    let {setup} = Component\r\n    if (setup) {\r\n        let context = createContext(instance)\r\n        let setupReturn = setup(instance.props, context)\r\n        handleSetupReturn(instance, setupReturn)\r\n    }else {\r\n\r\n    }\r\n}\r\nfunction createContext(instance) {\r\n    return {\r\n        attrs: instance.attrs,\r\n        slots: instance.slots,\r\n        emit: () => {},\r\n        expose: () => {}\r\n        // 如果用户使用了ref属性放到了组件上，expose默认拿到组件实例\r\n        // 但如果定义了expose, 默认拿到expose\r\n    }\r\n}\r\nfunction handleSetupReturn(instance, setupReturn) {\r\n    if (isFunction(setupReturn)) {\r\n        instance.render = setupReturn\r\n    }else if(isObject(setupReturn)){\r\n        instance.setupState = setupReturn\r\n    }\r\n    finishComponentSetup(instance)\r\n}\r\n/**\r\n * 完善实例\r\n * 1.补充render函数(有render直接用render,没render用template生成)\r\n */\r\nfunction finishComponentSetup(instance) {\r\n    let component = instance.vnode.type\r\n    if (!instance.render) {\r\n        if (!component.render && component.template) {\r\n            // TODO: template转render, 存到配置中(component)\r\n        }\r\n        instance.render = component.render\r\n    }\r\n}","import {createAppAPI} from \"./apiCreateApp\";\r\nimport {ShapeFlags} from \"@vue/shared\";\r\nimport {createComponentInstance, setupComponent} from \"./component\";\r\n\r\nexport function createRender(renderOption) {    // renderOption是不同平台传的值不同, 现在是只有dom平台\r\n    // Vnode -> realDOM\r\n    // [而vue2的render是执行_render函数生成Vnode, _update才是Vnode -> realDOM]\r\n    const render = (vnode, container) => {\r\n        patch(null, vnode, container)\r\n    }\r\n    const patch = (vnode1, vnode2, container) => {\r\n        // if (vnode1 !== null) {\r\n        //     // TODO: diff\r\n        // }else {\r\n            let {shapeFlag} = vnode2\r\n            if (shapeFlag & ShapeFlags.ELEMENT) {\r\n                // TODO: 传入的为元素\r\n            }else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\r\n                processComponent(vnode1, vnode2, container)\r\n            }\r\n        // }\r\n    }\r\n    return {\r\n        createApp: createAppAPI(render)\r\n    }\r\n}\r\n\r\nfunction processComponent(vnode1, vnode2, container) {\r\n    if (vnode1 === null) {\r\n        mountComponent(vnode2, container)\r\n    }else {\r\n        // TODO: 组件更新\r\n    }\r\n}\r\n\r\nfunction mountComponent(vnode2, container) {\r\n    let instance = createComponentInstance(vnode2)  // 创建组件实例对象\r\n    setupComponent(instance)    // 将setup数据添加到组件实例对象\r\n}\r\n"],"names":[],"mappings":"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"}