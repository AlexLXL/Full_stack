## 介绍mysql

### 1. 下载、安装

mysql下载: https://dev.mysql.com/downloads/mysql/  
workbench可视化下载: https://dev.mysql.com/downloads/workbench/

安裝mysql教程: http://c.biancheng.net/view/7135.html

woekbench连接数据库:

![woekbench连接数据库](./02.pic/009.jpg)

![woekbench查询数据库](./02.pic/010.jpg)

### 2. 建库

#### 2.1 图形化:

![建库1](./02.pic/011.jpg)

![建库2](./02.pic/012.jpg)

#### 2.2 命令:

```
CREATE SCHEMA `myblog` ;
```

### 3. 建表

#### 3.1 图形化:

![users表](./02.pic/015.jpg)

![blogs表](./02.pic/016.jpg)

#### 3.2 命令:

```
CREATE TABLE `myblog`.`users` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `realame` VARCHAR(45) NOT NULL,
  `userscol` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`));

CREATE TABLE `myblog`.`blogs` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(50) NOT NULL,
  `content` LONGTEXT NOT NULL,
  `createtime` BIGINT(20) NOT NULL DEFAULT 0,
  `author` VARCHAR(20) NOT NULL,
  `new_tablecol` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`));
```

#### 3.3 总结:

![users表](./02.pic/013.jpg)

![blogs表](./02.pic/014.jpg)

类型: `数字用int`, `超大数字用bigint(20)`, `字符串用varchar(20)`, `长文本用longtext`

### 4. 基本的sql语句

#### 4.1 增删改查

```
-- 使用数据库
use myblog;

-- 增
-- insert into users (username, `password`, realname) values ('lisi', '123', '李四');

-- 删(真删/软删)
-- delete from users where username = 'lisi';
-- update users set state = 1 where username = 'lisi'

-- 改
-- SET SQL_SAFE_UPDATES = 0
-- update users set realname='李四2' where username = 'lisi'

-- 查
-- select * from users;
-- select id, username from users;
-- select * from users where username = 'lisi' and `password` = '123';
-- select * from users where password like '%1%'
-- select * from users where password like '%1%' order by id desc; -- order表示排序、desc表示逆序
-- select * from users where state <> '0'; -- <>表示不等于
```

注释: sql语句前加`--`

### 5. 外键&连表查询



### 6. nodejs操作mysql

#### 6.1 示例: 用demo演示, 不考虑使用

新建文件夹
```
npm init -y
npm i mysql2
```

新建index.js
```
const mysql = require('mysql2')

const con = mysql.createConnection({
    host: 'localhost',
    port: '3306',
    user: 'root',
    password: 'root',
    database: 'myblog'
})

con.connect()

const sql = 'select * from users'
// const sql = `update users set realname = '李四2' where username = 'lisi'`
// const sql = `insert into users (username, \`password\`, realname) values ('xiaoming', '123', '小明');`

con.query(sql, (err, result) => {
    if (err) {
        console.log(err)
        return
    }
    console.log(result)
})

con.end()
```

运行即可操作数据库。

#### 6.2 将示例封装

src/conf/db.js

```
let MYSQL_CONFS = {
    dev: {
        host: 'localhost',
        port: '3306',
        user: 'root',
        password: 'root',
        database: 'myblog'
    },
    prd: {
        host: 'localhost',
        port: '3306',
        user: 'root',
        password: 'root',
        database: 'myblog'
    },
}

module.exports = {
    MYSQL_CONF: MYSQL_CONFS[process.env.NODE_ENV]
}
```

src/db/mysql.js

```
const mysql = require('mysql')
const {MYSQL_CONF} = require(../conf/db.js)

const mysql = require('mysql2')

const con = mysql.createConnection(MYSQL_CONF)
con.connect()

function exec(sql) {
    return new Promise((resolve, reject) => {
        con.query(sql, (err, result) => {
            if (err) {
                resolve(err)
                return
            }
            reject(result)
        })
    })
    
}

module.exports = { exec }
```

